version: "3"

includes:
  utils:
    taskfile: ./Util.yml
    internal: true
    dir: ../
  server:
    taskfile: ./Server.yml
    internal: true
    dir: ../
  cognito:
    taskfile: ./Cognito.yml
    internal: true
    dir: ../

tasks:
  e2e:
    desc: Run test files
    ignore_error: true
    deps: [utils:check-apigateway-env]
    cmds:
      - task: server:up-detach
      - task: cognito:authenticate-test-users
      - go test -v ./test/e2e/*.go
      - task: cognito:delete-test-users
      - task: server:down
